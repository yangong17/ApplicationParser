
{% extends "layout.html" %}

{% block content %}

<!-- jQuery dependency, needs to be at top of document -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<h2>Form Parser V1.0</h2>
<p style="margin-bottom: 100px;">Employee Information Sheets → Data Extraction → Exported as .csv</p>


<form action="/upload" method="post" enctype="multipart/form-data">
    
    <!-- Upload PDF -->
    <div class="form-group">
        <label for="pdf">Upload PDF:</label>
        <input type="file" class="form-control-file" id="pdf" name="file" accept=".pdf">
    </div>

    <!-- Submit Button for Upload -->
    <input type="submit" name="upload" value="Upload" class="btn btn-success">

</form>

<!-- Confirmation Message -->
{% if msg %}
<p class="alert alert-success mt-3">{{ msg }}</p>
<script>
    $("#pdf").attr("disabled", "disabled");  // Disable the file input
    $("input[type='submit']").attr("disabled", "disabled");  // Disable the upload button
</script>
{% endif %}


<form action="/execute" method="post" enctype="multipart/form-data">
   
    <!-- Button for Extract Key-Value Pairs -->
    <button id="executeBtn" class="btn btn-secondary mt-3">Extract Key-Value Pairs</button>

</form>

<!-- Placeholder for the extracted data table -->
<div id="dataTableContainer">
    <h4>Extracted Data:</h4>
    <table class="table table-bordered" id="extractedDataTable">
        <thead>
            <tr>
                <th>Key</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function(){
        var text = {{ text|tojson|safe }};  // Assuming you're passing 'text' from Flask to the template

        // Ensure that text has an even length (pairs of keys and values)
        if (text.length % 2 === 0) {
            for (let i = 0; i < text.length; i += 2) {
                let key = text[i];
                let value = text[i+1];

                // Append the key-value pair to the table
                $('#extractedDataTable tbody').append('<tr><td>' + key + '</td><td>' + value + '</td></tr>');
            }
        } else {
            console.error("The 'text' list doesn't have an even number of elements.");
        }
    });
</script>

<!-- Download File Button -->
<div class="mt-3">
    <a href="/download/filename_here" class="btn btn-success">Download Processed File</a>
</div>



{% endblock %}
